[gd_scene format=3 uid="uid://8uh7o2d0n413"]

[ext_resource type="Script" uid="uid://bbieu8y6ojge3" path="res://scenes/camera_controller.gd" id="1_ehlsf"]
[ext_resource type="Shader" uid="uid://b6q43re4kgskt" path="res://shaders/double_dither.gdshader" id="1_uey6o"]
[ext_resource type="Shader" uid="uid://d1738lv47fipn" path="res://shaders/flexible_toon.tres" id="2_6xpx8"]
[ext_resource type="Texture2D" uid="uid://dj11i3mbqtad0" path="res://materials/noise_perlin1.tres" id="2_bhrsq"]
[ext_resource type="Shader" uid="uid://be7ovwbc1nf5u" path="res://scenes/palette.gdshader" id="3_p2wle"]
[ext_resource type="PackedScene" uid="uid://culh51bwi8tkb" path="res://scenes/entity/empress.tscn" id="10_ym250"]
[ext_resource type="Texture2D" uid="uid://bd0x6xqclugrs" path="res://img/misc/20260211_191221.jpg" id="12_33qig"]
[ext_resource type="PackedScene" uid="uid://c4788n83007rf" path="res://scenes/entity/rookman.tscn" id="13_d2nbc"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ske1p"]
shader = ExtResource("3_p2wle")
shader_parameter/mix_amount = 1.1
shader_parameter/use_l = true
shader_parameter/use_c = true
shader_parameter/use_h = true
shader_parameter/steps_l = 17.0
shader_parameter/level_c = 3.93700018630898
shader_parameter/level_h = 0.04500000143898

[sub_resource type="ViewportTexture" id="ViewportTexture_ym250"]
viewport_path = NodePath("SubViewportContainer/SubViewport")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_bhrsq"]
shader = ExtResource("1_uey6o")
shader_parameter/center = Vector2(0.5, 0.5)
shader_parameter/radius = 0.8230000390925
shader_parameter/pixel_size = 1.0
shader_parameter/resolution = Vector2(1706.952, 480)
shader_parameter/dither_offset = Vector2(2, 0)
shader_parameter/bayer_size = 2
shader_parameter/interpolate = true
shader_parameter/invert = true
shader_parameter/falloff = 1.09600004880012
shader_parameter/color = Color(0.05, 0.00049999956, 0.0013249874, 1)
shader_parameter/noise_yes = ExtResource("2_bhrsq")
shader_parameter/direction = Vector2(1, 1)
shader_parameter/speed = 3.0

[sub_resource type="ViewportTexture" id="ViewportTexture_uey6o"]
viewport_path = NodePath("SubViewportContainer/SubViewport")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_uey6o"]
render_priority = 0
shader = ExtResource("2_6xpx8")
shader_parameter/albedo = Color(1, 1, 1, 1)
shader_parameter/clamp_diffuse_to_max = false
shader_parameter/cuts = 3
shader_parameter/wrap = 0.0
shader_parameter/steepness = 1.0
shader_parameter/use_attenuation = true
shader_parameter/use_specular = true
shader_parameter/specular_strength = 1.0
shader_parameter/specular_shininess = 16.0
shader_parameter/use_rim = true
shader_parameter/rim_width = 8.0
shader_parameter/rim_color = Color(1, 1, 1, 1)
shader_parameter/use_ramp = false
shader_parameter/use_borders = false
shader_parameter/border_width = 0.01

[sub_resource type="QuadMesh" id="QuadMesh_bhrsq"]
material = SubResource("ShaderMaterial_uey6o")
flip_faces = true
size = Vector2(2, 2)

[sub_resource type="Environment" id="Environment_ehlsf"]
background_mode = 1
background_color = Color(0.14901961, 0.21960784, 0.44313726, 1)

[sub_resource type="BoxShape3D" id="BoxShape3D_88gsq"]
size = Vector3(216, 1, 309)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_p2wle"]
render_priority = 0
shader = ExtResource("2_6xpx8")
shader_parameter/albedo = Color(1, 1, 1, 1)
shader_parameter/clamp_diffuse_to_max = false
shader_parameter/cuts = 4
shader_parameter/wrap = 0.0
shader_parameter/steepness = 1.0
shader_parameter/use_attenuation = true
shader_parameter/use_specular = true
shader_parameter/specular_strength = 1.0
shader_parameter/specular_shininess = 16.0
shader_parameter/use_rim = true
shader_parameter/rim_width = 8.0
shader_parameter/rim_color = Color(1, 1, 1, 1)
shader_parameter/use_ramp = false
shader_parameter/use_borders = false
shader_parameter/border_width = 0.01

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_ske1p"]
albedo_color = Color(0.58, 0.12760001, 0.12760001, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_t7cxt"]
material = SubResource("StandardMaterial3D_ske1p")
size = Vector2(100, 100)

[sub_resource type="ConcavePolygonShape3D" id="ConcavePolygonShape3D_6xpx8"]
data = PackedVector3Array(50, 0, 50, -50, 0, 50, 50, 0, -50, -50, 0, 50, -50, 0, -50, 50, 0, -50)

[sub_resource type="Gradient" id="Gradient_t7cxt"]

[sub_resource type="GradientTexture2D" id="GradientTexture2D_6xpx8"]
gradient = SubResource("Gradient_t7cxt")

[sub_resource type="PlaceholderTexture2D" id="PlaceholderTexture2D_t7cxt"]

[sub_resource type="Gradient" id="Gradient_uey6o"]
offsets = PackedFloat32Array(0.12992126, 0.33661416, 0.9980315)
colors = PackedColorArray(0, 0.118500076, 0.79, 1, 0.012230534, 0.09069317, 0.53531444, 1, 0.36339998, 0.79, 0.38472995, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_p2wle"]
gradient = SubResource("Gradient_uey6o")
fill_from = Vector2(0, 1)
fill_to = Vector2(0, 0)

[node name="Node3D" type="Node3D" unique_id=128075882]

[node name="SubViewportContainer" type="SubViewportContainer" parent="." unique_id=654618086]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true

[node name="Palette" type="TextureRect" parent="SubViewportContainer" unique_id=531962064]
material = SubResource("ShaderMaterial_ske1p")
layout_mode = 2
texture = SubResource("ViewportTexture_ym250")

[node name="Dithering" type="TextureRect" parent="SubViewportContainer" unique_id=1842946926]
texture_filter = 1
texture_repeat = 2
material = SubResource("ShaderMaterial_bhrsq")
layout_mode = 2
texture = SubResource("ViewportTexture_uey6o")

[node name="SubViewport" type="SubViewport" parent="SubViewportContainer" unique_id=1777692267]
handle_input_locally = false
size = Vector2i(1152, 648)
size_2d_override = Vector2i(640, 360)
size_2d_override_stretch = true
render_target_update_mode = 4

[node name="level" type="Node3D" parent="SubViewportContainer/SubViewport" unique_id=524029290]

[node name="camera_root" type="Node3D" parent="SubViewportContainer/SubViewport/level" unique_id=271371179 node_paths=PackedStringArray("camera", "player")]
script = ExtResource("1_ehlsf")
camera = NodePath("cammie")
player = NodePath("../empress")

[node name="cammie" type="Camera3D" parent="SubViewportContainer/SubViewport/level/camera_root" unique_id=682176110]
transform = Transform3D(0.7071067, -0.35355335, 0.61237234, 0, 0.86602527, 0.49999997, -0.7071067, -0.35355335, 0.61237234, 55, 50, 55)
projection = 1
current = true
size = 20.0

[node name="ScreenQuad" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/level/camera_root/cammie" unique_id=1389230355]
transform = Transform3D(0.7071068, 0, -0.7071068, -0.3535534, 0.86602545, -0.3535534, 0.6123724, 0.49999997, 0.6123724, 0, -4.4103966, -92.36096)
visible = false
mesh = SubResource("QuadMesh_bhrsq")

[node name="empress" parent="SubViewportContainer/SubViewport/level" unique_id=191184070 node_paths=PackedStringArray("camera") instance=ExtResource("10_ym250")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.2010002, 0)
camera = NodePath("../camera_root/cammie")

[node name="WorldEnvironment" type="WorldEnvironment" parent="SubViewportContainer/SubViewport/level" unique_id=1296131750]
environment = SubResource("Environment_ehlsf")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="SubViewportContainer/SubViewport/level" unique_id=533188848]
transform = Transform3D(0.7071068, -0.50000006, 0.5, -1.7763568e-15, 0.7071068, 0.70710677, -0.70710677, -0.5000002, 0.49999997, 0, -14.270843, 0)

[node name="Sprite3D" type="Sprite3D" parent="SubViewportContainer/SubViewport/level" unique_id=2094981583]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 1.0999999, 0)
visible = false
modulate = Color(1, 1, 1, 0.54901963)
pixel_size = 0.12
texture_filter = 2
texture = ExtResource("12_33qig")

[node name="StaticBody3D" type="StaticBody3D" parent="SubViewportContainer/SubViewport/level/Sprite3D" unique_id=950877519]
transform = Transform3D(1, 0, 0, 0, -4.371139e-08, 1, 0, -1, -4.371139e-08, 0, 0, 0)
collision_layer = 8
collision_mask = 8

[node name="CollisionShape3D" type="CollisionShape3D" parent="SubViewportContainer/SubViewport/level/Sprite3D/StaticBody3D" unique_id=268678873]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0.5)
shape = SubResource("BoxShape3D_88gsq")

[node name="Enemies" type="Node" parent="SubViewportContainer/SubViewport/level" unique_id=1851871287]

[node name="rookman" parent="SubViewportContainer/SubViewport/level/Enemies" unique_id=1860973982 instance=ExtResource("13_d2nbc")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -8, 2, -11.6)

[node name="gym" type="Node3D" parent="SubViewportContainer/SubViewport/level" unique_id=1966527848]

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewportContainer/SubViewport/level/gym" unique_id=36221702]
material_overlay = SubResource("ShaderMaterial_p2wle")
mesh = SubResource("PlaneMesh_t7cxt")

[node name="StaticBody3D" type="StaticBody3D" parent="SubViewportContainer/SubViewport/level/gym/MeshInstance3D" unique_id=1493127842]

[node name="CollisionShape3D" type="CollisionShape3D" parent="SubViewportContainer/SubViewport/level/gym/MeshInstance3D/StaticBody3D" unique_id=1800622880]
shape = SubResource("ConcavePolygonShape3D_6xpx8")

[node name="UI" type="Control" parent="." unique_id=1065629105]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="MarginContainer" type="MarginContainer" parent="UI" unique_id=578211851]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 36.0
offset_top = 19.0
offset_right = -1017.0
offset_bottom = -542.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/margin_left = 6
theme_override_constants/margin_top = 6
theme_override_constants/margin_right = 6
theme_override_constants/margin_bottom = 6

[node name="MarginContainer2" type="MarginContainer" parent="UI" unique_id=796323669]
visible = false
layout_mode = 1
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 25.0
offset_top = -332.0
offset_right = 94.0
offset_bottom = -32.0
grow_vertical = 0
size_flags_horizontal = 0
size_flags_vertical = 0
theme_override_constants/margin_left = 6
theme_override_constants/margin_top = 6
theme_override_constants/margin_right = 6
theme_override_constants/margin_bottom = 6

[node name="div_eye" type="TextureRect" parent="UI" unique_id=219159700]
layout_mode = 0
offset_left = 42.0
offset_top = 25.0
offset_right = 129.0
offset_bottom = 100.0
texture = SubResource("GradientTexture2D_6xpx8")

[node name="fluxbar" type="TextureProgressBar" parent="UI" unique_id=488476030]
layout_mode = 0
offset_left = 31.0
offset_top = 322.0
offset_right = 88.0
offset_bottom = 610.0
value = 100.0
rounded = true
fill_mode = 3
nine_patch_stretch = true
texture_under = SubResource("PlaceholderTexture2D_t7cxt")
texture_progress = SubResource("GradientTexture2D_p2wle")
